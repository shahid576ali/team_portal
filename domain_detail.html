<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Team - Gesture Nexus</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <header class="header">
            <h1 id="teamHeader">OUR TEAM</h1>
            <button id="addDomainBtn" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal"
                data-bs-whatever="@fat">Add Team</button>

        </header>

        <input type="text" id="searchBar" class="form-control mb-4" placeholder="Search team members..."
            onkeyup="filterCards()">

        <div class="team-grid" id="teamGrid">
            <!-- Team members will be displayed here -->
            <div class="team-member">
                <a href="team.html" style="text-decoration: none; color: inherit;">
                    <div class="profile-image">
                        <img src="images/tech2.png" alt="Echo 1">
                    </div>
                    <h3 class="member-name">Echo 1</h3>
                    <p class="member-description">Our Web Development Team crafts innovative, user-friendly, and
                        responsive websites that bring ideas to life.</p>
                    <div class="social-links">
                        <a href="#" class="social-icon facebook">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                            </svg>
                        </a>
                        <a href="#" class="social-icon instagram">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                            </svg>
                        </a>
                        <a href="#" class="social-icon linkedin">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z">
                                </path>
                                <rect x="2" y="9" width="4" height="12"></rect>
                                <circle cx="4" cy="4" r="2"></circle>
                            </svg>
                        </a>
                        <a href="#" class="social-icon twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
                                </path>
                            </svg>
                        </a>
                    </div>
                </a>
            </div>
            <div class="team-member">
                <a href="team_member.html?id=2" style="text-decoration: none; color: inherit;">
                    <div class="profile-image">
                        <img src="images/tech2.png" alt="Echo 2">
                    </div>
                    <h3 class="member-name">Echo 2</h3>
                    <p class="member-description">Our Web Development Team crafts innovative, user-friendly, and
                        responsive websites that bring ideas to life.</p>
                    <div class="social-links">
                        <a href="#" class="social-icon facebook">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                            </svg>
                        </a>
                        <a href="#" class="social-icon instagram">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                            </svg>
                        </a>
                        <a href="#" class="social-icon linkedin">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z">
                                </path>
                                <rect x="2" y="9" width="4" height="12"></rect>
                                <circle cx="4" cy="4" r="2"></circle>
                            </svg>
                        </a>
                        <a href="#" class="social-icon twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
                                </path>
                            </svg>
                        </a>
                    </div>
                </a>
            </div>

        </div>
    </div>
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Add Team</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="add_team">
                    <div class="modal-body">

                        <div class="mb-3">
                            <label for="recipient-name" class="col-form-label">Team Name:</label>
                            <input type="text" class="form-control" id="team_name" name="team_name"
                                placeholder="Team Name">
                        </div>
                        <div class="mb-3">
                            <label for="message-text" class="col-form-label">Image:</label>
                            <input type="file" class="form-control" id="team_image" name="team_image">
                        </div>
                        <div class="mb-3">
                            <label for="message-text" class="col-form-label">Description:</label>
                            <textarea class="form-control" id="description" placeholder="Description..."
                                name="description"></textarea>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        let teamMembers = [];  // Declare a global variable to store team data
        const urlParams = new URLSearchParams(window.location.search);
        const memberId = urlParams.get('id');
        console.log(memberId);
        async function fetchTeamData() {
            try {
                const response = await fetch(`domain_detail.php?id=${memberId}`); // Replace with 'getTeamData.php' if using PHP
                if (!response.ok) {
                    throw new Error('Network response was not ok');

                }
                teamMembers = await response.json(); // Store the fetched data
                displayTeamMembers(teamMembers); // Display the fetched data
            } catch (error) {
                console.error('Error fetching team data:', error);
                console.log(`URL being fetched: domain_detail.php?id=${memberId}`);
            }
        }

        function createTeamMemberCard(member) {
            const token = localStorage.getItem('token'); // Check token presence
            const removeButtonHTML = token
                ? `
            <div class="remove">
                <button type="button" class="btn btn-danger remove" data-id="${member.Id}" onclick="removeDomain(${member.Id})" data-bs-dismiss="modal">
                    Remove
                </button>
            </div>
            `
                : ''; // Hide the button if no token

            return `
                <div class="team-member">
                    <a href="team_member.html?id=${member.Id}" style="text-decoration: none; color: inherit;">
                        <div class="profile-image">
                            <img src="images/${member.Image}" alt="${member.Name}">
                        </div>
                        <h3 class="member-name">${member.Name}</h3>
                        <p class="member-description">${member.Description}</p>
                        <div class="social-links">
                            <a href="#" class="social-icon facebook">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
                            </a>
                            <a href="#" class="social-icon instagram">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                            </a>
                            <a href="#" class="social-icon linkedin">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
                            </a>
                            <a href="#" class="social-icon twitter">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
                            </a>
                        </div>
                ${removeButtonHTML} <!-- Conditionally include the Remove button -->
                    </a>
                </div>
            `;
        }

        function displayTeamMembers(teamMembers) {
            const teamGrid = document.getElementById('teamGrid');
            teamGrid.innerHTML = teamMembers.map(createTeamMemberCard).join('');
        }

        function filterCards() {
            const searchValue = document.getElementById('searchBar').value.toLowerCase();
            const filteredMembers = teamMembers.filter(member =>
                member.Name.toLowerCase().includes(searchValue) ||
                member.Description.toLowerCase().includes(searchValue)
            );
            const teamGrid = document.getElementById('teamGrid');
            teamGrid.innerHTML = filteredMembers.map(createTeamMemberCard).join('');
        }

        async function fetchTeamName() {
            try {
                const response = await fetch(`domain_detail.php?name=${memberId}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                    alert('Team Not Found');
                }

                const data = await response.json();
                if (data.error) {
                    console.error(data.error);
                    document.querySelector('.header h1').innerText = "Team Not Found";
                    alert('Team Not Found');
                } else {
                    console.log(data.Name);
                    document.querySelector('.header h1').innerText = data.Name; // Replace header text
                }
            } catch (error) {
                console.error('Error fetching team name:', error);
            }
        }

        // Fetch and display team data on page load
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('token');
            fetchTeamData(); // Fetch data if logged in
            // Fetch team name on page load
            fetchTeamName();
            const addDomainBtn = document.getElementById('addDomainBtn');
            if (token) {
                addDomainBtn.style.display = 'block'; // Show the button
            } else {
                addDomainBtn.style.display = 'none'; // Hide the button
            }
        });
        document.getElementById('add_team').addEventListener('submit', async (event) => {
            event.preventDefault();

            const formData = new FormData();
            formData.append('team_name', document.getElementById('team_name').value);
            formData.append('team_image', document.getElementById('team_image').files[0]);
            formData.append('description', document.getElementById('description').value);
            formData.append('domain_id', memberId);
            try {
                const response = await fetch('domain_detail.php', {
                    method: 'POST',
                    body: formData,
                });

                const data = await response.json();

                if (response.ok) {
                    // Save session token in localStorage
                    alert('Domain Added Successfully');

                    // Redirect to a protected page
                    window.location.href = `domain_detail.html?id=${memberId}`;
                } else {
                    alert(data.message || 'Login failed');
                }
            } catch (error) {
                console.error('Error:', error);
                // alert(data.message || 'An error occurred. Please try again');
                alert('An error occurred. Please');
            }
        });

        async function removeDomain(id) {
            if (!confirm('Are you sure you want to delete this domain?')) {
                return; // Exit if the user cancels the confirmation
            }

            try {
                const response = await fetch(`domain_detail.php?remove_domain=${id}`, {
                    method: 'GET',
                });

                if (!response.ok) {
                    throw new Error('Failed to delete domain');
                }

                const data = await response.json();

                if (data.success) {
                    alert('Domain removed successfully');
                    window.location.href = `domain_detail.html?id=${memberId}`;
                    fetchTeamData(); // Refresh the team data

                } else {
                    alert(data.message || 'Failed to remove domain');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while removing the domain.');
            }
        }


    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
</body>

</html>